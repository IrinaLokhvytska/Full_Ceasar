{"version":3,"sources":["EditGroup.js"],"names":[],"mappings":"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","file":"EditGroup-compiled.js","sourcesContent":["'use strict';\r\nclass EditGroup {\r\n\r\n    constructor (urlArray, editGroupModalElement) {\r\n        this.getLocationsUrl = urlArray[0];\r\n        this.getTeachersListUrl = urlArray[1];\r\n        this.getDirectionsListUrl = urlArray[2];\r\n        this.createUrl = urlArray[3];\r\n        this.editUrl = urlArray[4];\r\n        this.editGroupModalElement = editGroupModalElement;\r\n        this.defineElements(this.editGroupModalElement);\r\n        this.attachEvents();\r\n        this.getLocationFromDb();\r\n        this.locationList = [];\r\n    }\r\n\r\n    defineElements (parentEl) {\r\n        this.dateCourse = new DateCourse(this.getDirectionsListUrl, parentEl);\r\n        this.budgetOwner = new BudgetOwner(parentEl);\r\n        this.teachers = new TeachersSelect(this.getTeachersListUrl, parentEl);\r\n        this.experts = new ExpertsInput(parentEl);\r\n        this.name = parentEl.querySelector('.groupName');\r\n        this.location = parentEl.querySelector('select.location');\r\n        this.direction = parentEl.querySelector('select.direction');\r\n        this.submit = parentEl.querySelector('.submit');\r\n        this.closeModal = parentEl.querySelector('.close-modal');\r\n        this.messageBox = document.querySelector('.errorName');\r\n        this.editGroupBtn = document.querySelector('.gear-img');\r\n        this.SsOwner = parentEl.querySelector('#SsOwner');\r\n        this.OgOwner = parentEl.querySelector('#OgOwner');\r\n        this.classLabel = \"active\";\r\n        this.teachersLists = parentEl.querySelectorAll('.teachers')\r\n        this.expertsInputs = parentEl.querySelectorAll('.experts')\r\n    }\r\n\r\n    fillFields() {\r\n        this.groupId = this.editGroupBtn.dataset.groupId;\r\n        this.name.value = this.editGroupBtn.dataset.groupName;\r\n        this.dateCourse.startDate.value = this.editGroupBtn.dataset.groupStartDate;\r\n        this.dateCourse.processDate();\r\n        let budget = this.editGroupBtn.dataset.groupBudget;\r\n        this.setBudgetButton(budget);\r\n        this.location.value = this.editGroupBtn.dataset.groupLocationId;\r\n        this.direction.value = this.editGroupBtn.dataset.groupDirectionId;\r\n    }\r\n\r\n    setBudgetButton (budget) {\r\n        if (budget === 'softserve') {\r\n            this.SsOwner.classList.add(this.classLabel);\r\n            this.OgOwner.classList.remove(this.classLabel);\r\n        } else {\r\n            this.OgOwner.classList.add(this.classLabel);\r\n            this.SsOwner.classList.remove(this.classLabel);\r\n        }\r\n    }\r\n\r\n    attachEvents () {\r\n        this.editGroupBtn.addEventListener('click', () =>{\r\n            this.fillFields();\r\n        });\r\n        this.name.addEventListener('blur', () => {\r\n            this.validateName();\r\n        });\r\n        this.submit.addEventListener('click', () => {\r\n            this.save();\r\n        });\r\n\r\n        document.addEventListener('keydown', event => {\r\n            if (event.key === 'Escape' || event.keyCode === 27) {\r\n                this.close();\r\n            } else if (event.key === 'Enter' || event.keyCode === 13) {\r\n                event.preventDefault();\r\n                this.save();\r\n            }\r\n        });\r\n    }\r\n\r\n    getLocationFromDb () {\r\n        return Frame.ajaxResponse('GET', this.getLocationsUrl, this.saveLocations.bind(this));\r\n    }\r\n\r\n    saveLocations(data) {\r\n        this.locationList = data;\r\n        this.initLocationList();\r\n    }\r\n\r\n    initLocationList () {\r\n        this.locationList.forEach((location) => {\r\n            let opt = document.createElement('option');\r\n            opt.value = location.id;\r\n            opt.innerHTML = location.full_name;\r\n            this.location.appendChild(opt);\r\n        });\r\n    }\r\n\r\n    validateName () {\r\n        let name = this.name.value,\r\n            pattern = /^[а-яА-Я0-9-\\. !@#$%^&*()_=+\"']{4,20}$|^[a-zA-Z0-9-\\. !@#$%^&*()_=+\"']{4,20}$/;\r\n\r\n        if(20 < name.length || name.length <4) {\r\n            this.messageBox.innerHTML = ('The length of group:4-20 chars');\r\n            this.name.style.borderColor = \"red\";\r\n\r\n            return false;\r\n\r\n        } else {\r\n            if (!pattern.test(name)) {\r\n                this.messageBox.innerHTML = ('You use invalid characters');\r\n                this.name.style.borderColor = \"red\";\r\n\r\n                return false;\r\n\r\n            } else {\r\n                this.messageBox.style.display = \"none\";\r\n                this.name.style.borderColor = \"black\";\r\n\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n\r\n    isValid () {\r\n        const isNameValid = this.validateName();\r\n        const isExpertsValid = this.experts.validateExperts();\r\n        const isDateValid = this.dateCourse.validateDate();\r\n\r\n        return (isNameValid && isExpertsValid && isDateValid);\r\n    }\r\n\r\n    save () {\r\n        if (this.isValid()) {\r\n\r\n            this._sendData(this._getFormData());\r\n        } else {\r\n\r\n            console.log('Data not send');\r\n        }\r\n    }\r\n\r\n    close () {\r\n        this.closeModal.click();\r\n    }\r\n\r\n    _sendData (data) {\r\n\r\n        let xmlhttp;\r\n\r\n        if (window.XMLHttpRequest) {\r\n            xmlhttp = new XMLHttpRequest();\r\n        } else {\r\n            xmlhttp = new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n        }\r\n\r\n        xmlhttp.open(\"POST\", this.editUrl, false);\r\n        xmlhttp.send(data);\r\n\r\n        this.close();\r\n        location.reload();\r\n    }\r\n\r\n    _getFormData () {\r\n        let data = {};\r\n        data.id = this.editGroupBtn.dataset.groupId;\r\n        data.name = this.name.value;\r\n        data.location_id = this.location.value;\r\n        data.direction_id = this.dateCourse.direction.value;\r\n        data.start_date = this.dateCourse.startDate.value;\r\n        data.finish_date = this.dateCourse.finishDate.value;\r\n        data.budget =  this.budgetOwner.budgetOwner;\r\n\r\n        let teachersLists = this.teachersLists,\r\n            selectedTeachersIDs = [];\r\n\r\n        teachersLists.forEach((teacherList) => {\r\n            selectedTeachersIDs.push(parseInt(teacherList.options[teacherList.selectedIndex].value));\r\n        });\r\n        data.teachers = selectedTeachersIDs;\r\n\r\n        let expertsInputs = this.expertsInputs,\r\n            expertsIDs = [];\r\n\r\n        expertsInputs.forEach((expertInput) => {\r\n            expertsIDs.push(expertInput.value);\r\n        });\r\n        data.experts = expertsIDs;\r\n        data = JSON.stringify(data);\r\n        console.log(data);\r\n\r\n        return data;\r\n    }\r\n\r\n}\r\n"]}