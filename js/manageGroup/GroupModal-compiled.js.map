{"version":3,"sources":["GroupModal.js"],"names":[],"mappings":"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","file":"GroupModal-compiled.js","sourcesContent":["'use strict';\r\nclass GroupModal {\r\n\r\n    constructor (urlArray, elements) {\r\n        this.getLocationsUrl = urlArray[0];\r\n        this.getTeachersListUrl = urlArray[1];\r\n        this.getDirectionsListUrl = urlArray[2];\r\n        this.createUrl = urlArray[3];\r\n        this.editUrl = urlArray[4];\r\n        this.defineElements(elements);\r\n        this.attachEvents();\r\n        this.getLocationFromDb();\r\n    }\r\n\r\n    defineElements (elements) {\r\n        this.dateCourse = new DateCourse(this.getDirectionsListUrl, elements);\r\n        this.budgetOwner = new BudgetOwner(elements);\r\n        this.teachers = new TeachersSelect(this.getTeachersListUrl, elements);\r\n        this.experts = new ExpertsInput(elements);\r\n        this.name = elements.querySelector('.groupName');\r\n        this.location = elements.querySelector('.location');\r\n        this.submit = elements.querySelector('.submit');\r\n        this.closeModal = elements.querySelector('.close-modal');\r\n        this.messageBox = elements.querySelector('.errorName');\r\n        this.teachersLists = elements.querySelectorAll('.teachers');\r\n        this.expertsInputs = document.querySelectorAll('.experts')\r\n    }\r\n\r\n    attachEvents () {\r\n        this.name.addEventListener('blur', () => {\r\n            this.validateName();\r\n        });\r\n        this.submit.addEventListener('click', () => {\r\n            this.save();\r\n        });\r\n\r\n        document.addEventListener('keydown', event => {\r\n            if (event.key === 'Escape' || event.keyCode === 27) {\r\n                this.close();\r\n            } else if (event.key === 'Enter' || event.keyCode === 13) {\r\n                event.preventDefault();\r\n                this.save();\r\n            }\r\n        });\r\n    }\r\n\r\n    getLocationFromDb () {\r\n        return Frame.ajaxResponse('GET', this.getLocationsUrl, this.initLocation.bind(this));\r\n    }\r\n\r\n    initLocation (data) {\r\n        let opt = document.createElement('option');\r\n        opt.value = data.id;\r\n        opt.innerHTML = data.full_name;\r\n        this.location.appendChild(opt);\r\n    }\r\n\r\n    validateName () {\r\n        let name = this.name.value,\r\n            pattern = /^[а-яА-Я0-9-\\. !@#$%^&*()_=+\"']{4,20}$|^[a-zA-Z0-9-\\. !@#$%^&*()_=+\"']{4,20}$/;\r\n\r\n        if(20 < name.length || name.length <4) {\r\n            this.messageBox.innerHTML = ('The length of group:4-20 chars');\r\n            this.name.style.borderColor = \"red\";\r\n\r\n            return false;\r\n\r\n        } else {\r\n            if (!pattern.test(name)) {\r\n                this.messageBox.innerHTML = ('You use invalid characters');\r\n                this.name.style.borderColor = \"red\";\r\n\r\n                return false;\r\n\r\n            } else {\r\n                this.messageBox.style.display = \"none\";\r\n                this.name.style.borderColor = \"black\";\r\n\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n\r\n    isValid () {\r\n        const isNameValid = this.validateName();\r\n        const isExpertsValid = this.experts.validateExperts();\r\n        const isDateValid = this.dateCourse.validateDate();\r\n\r\n        return (isNameValid && isExpertsValid && isDateValid);\r\n    }\r\n\r\n    save () {\r\n        if (this.isValid()) {\r\n\r\n            this._sendData(this._getFormData());\r\n        } else {\r\n\r\n            console.log('Data not send');\r\n        }\r\n    }\r\n\r\n    close () {\r\n        this.closeModal.click();\r\n    }\r\n\r\n    _sendData (data) {\r\n\r\n        let xmlhttp;\r\n\r\n        if (window.XMLHttpRequest) {\r\n            xmlhttp = new XMLHttpRequest();\r\n        } else {\r\n            xmlhttp = new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n        }\r\n\r\n        xmlhttp.open(\"POST\", this.createUrl, false);\r\n        xmlhttp.send(data);\r\n\r\n        this.close();\r\n        location.reload();\r\n    }\r\n\r\n    _getFormData () {\r\n        let data = {};\r\n        data.name = this.name.value;\r\n        data.location_id = this.location.value;\r\n        data.direction_id = this.dateCourse.direction.value;\r\n        data.start_date = this.dateCourse.startDate.value;\r\n        data.finish_date = this.dateCourse.finishDate.value;\r\n        data.budget =  this.budgetOwner.budgetOwner;\r\n\r\n        let teachersLists = this.teachersLists,\r\n            selectedTeachersIDs = [];\r\n\r\n        teachersLists.forEach((teacherList) => {\r\n            selectedTeachersIDs.push(parseInt(teacherList.options[teacherList.selectedIndex].value));\r\n        });\r\n        data.teachers = selectedTeachersIDs;\r\n\r\n        let expertsInputs = this.expertsInputs,\r\n            expertsIDs = [];\r\n\r\n        expertsInputs.forEach((expertInput) => {\r\n            expertsIDs.push(expertInput.value);\r\n        });\r\n        data.experts = expertsIDs;\r\n        data = JSON.stringify(data);\r\n        console.log(data);\r\n\r\n        return data;\r\n    }\r\n\r\n}\r\n"]}